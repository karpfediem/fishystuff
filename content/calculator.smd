---
.title = "Fishing Calculator",
.date = @date("2025-03-23T00:00:00"),
.author = "Karpfen",
.layout = "calculator.shtml",
.draft = false,
.tags = ["calculator", "AFR", "DRR"],
---

## Coming soon (WIP)

```=html
<script>
    const items = [
        {
            "name": "8-Piece Outfit Set Effect",
            "type": "outfit",
            "afr": null,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": null,
            "drr": 0.1,
            "fish_multiplier": null,
            "exp_fish": null,
            "exp_life": null,
            "id": null,
            "icon_id": null,
            "icon": null
        },
        {
            "name": "Ash Tree Float",
            "type": "float",
            "afr": null,
            "bonus_rare": 0,
            "bonus_big": 0.11,
            "durability": 100,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": null,
            "exp_life": null,
            "id": 16167,
            "icon_id": 16167,
            "icon": "/static/icons/items/00016167.webp"
        },
        {
            "name": "Awakening Weapon Outfit",
            "type": "outfit",
            "afr": null,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": null,
            "drr": 0.1,
            "fish_multiplier": null,
            "exp_fish": null,
            "exp_life": null,
            "id": null,
            "icon_id": null,
            "icon": null
        },
        {
            "name": "Balacs Lunchbox",
            "type": "food",
            "afr": 0.07,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": null,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": 0.1,
            "exp_life": null,
            "id": 9359,
            "icon_id": 9359,
            "icon": "/static/icons/items/00009359.webp"
        },
        {
            "name": "Balenos Fishing Rod",
            "type": "rod",
            "afr": 0.25,
            "bonus_rare": 0,
            "bonus_big": 0,
            "durability": 100,
            "drr": null,
            "fish_multiplier": 1,
            "exp_fish": null,
            "exp_life": null,
            "id": 16162,
            "icon_id": 16162,
            "icon": "/static/icons/items/00016162.webp"
        },
        {
            "name": "Blacksmith's Blessing",
            "type": "lightstone_set",
            "afr": 0,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": null,
            "drr": 0.3,
            "fish_multiplier": null,
            "exp_fish": null,
            "exp_life": null,
            "id": null,
            "icon_id": null,
            "icon": null
        },
        {
            "name": "Calpheon Fishing Rod",
            "type": "rod",
            "afr": 0,
            "bonus_rare": 0,
            "bonus_big": 0.11,
            "durability": 50,
            "drr": null,
            "fish_multiplier": 1,
            "exp_fish": null,
            "exp_life": null,
            "id": 16164,
            "icon_id": 16164,
            "icon": "/static/icons/items/00016164.webp"
        },
        {
            "name": "Choice & Focus: Fishing",
            "type": "lightstone_set",
            "afr": null,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": null,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": 0.41,
            "exp_life": null,
            "id": null,
            "icon_id": null,
            "icon": null
        },
        {
            "name": "Coconut Cocktail",
            "type": "food",
            "afr": 0.05,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": null,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": null,
            "exp_life": null,
            "id": 9307,
            "icon_id": 9307,
            "icon": "/static/icons/items/00009307.webp"
        },
        {
            "name": "Cool Wind Fishing Rod",
            "type": "rod",
            "afr": 1,
            "bonus_rare": 0,
            "bonus_big": 0,
            "durability": 1000,
            "drr": null,
            "fish_multiplier": 1.6,
            "exp_fish": null,
            "exp_life": null,
            "id": 767187,
            "icon_id": 767187,
            "icon": "/static/icons/items/00767187.webp"
        },
        {
            "name": "Crio Fisher's Chair",
            "type": "chair",
            "afr": 0.07,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": 200,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": 0.2,
            "exp_life": null,
            "id": 705538,
            "icon_id": 705538,
            "icon": "/static/icons/items/00705538.webp"
        },
        {
            "name": "Crio's Fishing Chair",
            "type": "chair",
            "afr": 0,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": 100,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": null,
            "exp_life": null,
            "id": 12831,
            "icon_id": 12831,
            "icon": "/static/icons/items/00012831.webp"
        },
        {
            "name": "Crio's Sturdy Fishing Chair",
            "type": "chair",
            "afr": 0.05,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": 200,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": null,
            "exp_life": null,
            "id": 12930,
            "icon_id": 12831,
            "icon": "/static/icons/items/00012831.webp"
        },
        {
            "name": "Grandpa Cron's Fishing Rod",
            "type": "rod",
            "afr": 1,
            "bonus_rare": 0,
            "bonus_big": 0,
            "durability": 2000,
            "drr": null,
            "fish_multiplier": 1.6,
            "exp_fish": null,
            "exp_life": null,
            "id": 767158,
            "icon_id": 760976,
            "icon": "/static/icons/items/00760976.webp"
        },
        {
            "name": "Lil' Otter Fishing Carrier \uD83E\uDDA6",
            "type": "backpack",
            "afr": null,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": null,
            "drr": 0.1,
            "fish_multiplier": null,
            "exp_fish": 0.2,
            "exp_life": null,
            "id": 830150,
            "icon_id": 830150,
            "icon": "/static/icons/items/00830150.webp"
        },
        {
            "name": "Loggia Fishing Chair",
            "type": "chair",
            "afr": 0.05,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": 200,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": 0.1,
            "exp_life": null,
            "id": 705537,
            "icon_id": 705537,
            "icon": "/static/icons/items/00705537.webp"
        },
        {
            "name": "Mainhand Weapon Outfit",
            "type": "outfit",
            "afr": null,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": null,
            "drr": 0.1,
            "fish_multiplier": null,
            "exp_fish": null,
            "exp_life": null,
            "id": null,
            "icon_id": null,
            "icon": null
        },
        {
            "name": "Manos Fishing Chair",
            "type": "chair",
            "afr": 0.1,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": 200,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": 0.3,
            "exp_life": null,
            "id": 705539,
            "icon_id": 705539,
            "icon": "/static/icons/items/00705539.webp"
        },
        {
            "name": "Maple Float",
            "type": "float",
            "afr": null,
            "bonus_rare": 0.05,
            "bonus_big": 0,
            "durability": 100,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": null,
            "exp_life": null,
            "id": 16168,
            "icon_id": 16168,
            "icon": "/static/icons/items/00016168.webp"
        },
        {
            "name": "Marvelous Balacs Lunchbox",
            "type": "food",
            "afr": 0.1,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": null,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": 0.25,
            "exp_life": null,
            "id": 9643,
            "icon_id": 9643,
            "icon": "/static/icons/items/00009643.webp"
        },
        {
            "name": "Mediah Fishing Rod",
            "type": "rod",
            "afr": 0,
            "bonus_rare": 0.05,
            "bonus_big": 0,
            "durability": 50,
            "drr": null,
            "fish_multiplier": 1,
            "exp_fish": null,
            "exp_life": null,
            "id": 16165,
            "icon_id": 16165,
            "icon": "/static/icons/items/00016165.webp"
        },
        {
            "name": "Nibbles",
            "type": "lightstone_set",
            "afr": 0.15,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": null,
            "drr": 0,
            "fish_multiplier": null,
            "exp_fish": 0.13,
            "exp_life": null,
            "id": null,
            "icon_id": null,
            "icon": null
        },
        {
            "name": "Palm Tree Float \uD83C\uDF34",
            "type": "float",
            "afr": null,
            "bonus_rare": 0.05,
            "bonus_big": 0,
            "durability": 70,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": null,
            "exp_life": null,
            "id": 16170,
            "icon_id": 16170,
            "icon": "/static/icons/items/00016170.webp"
        },
        {
            "name": "Perfume of Swiftness",
            "type": "buff",
            "afr": null,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": null,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": null,
            "exp_life": 0.2,
            "id": 735,
            "icon_id": 735,
            "icon": "/static/icons/items/00000735.webp"
        },
        {
            "name": "Professional Fisher's Uniform (Costume)",
            "type": "outfit",
            "afr": null,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": null,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": null,
            "exp_life": 0.1,
            "id": 14330,
            "icon_id": 14071,
            "icon": "/static/icons/items/00014071.webp"
        },
        {
            "name": "Seafood Cron Meal",
            "type": "food",
            "afr": null,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": null,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": null,
            "exp_life": 0.1,
            "id": 9691,
            "icon_id": 9691,
            "icon": "/static/icons/items/00009691.webp"
        },
        {
            "name": "Sharp-Eyed Seagull",
            "type": "lightstone_set",
            "afr": null,
            "bonus_rare": 0.05,
            "bonus_big": null,
            "durability": null,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": 0.13,
            "exp_life": null,
            "id": null,
            "icon_id": null,
            "icon": null
        },
        {
            "name": "Treant's Tear",
            "type": "buff",
            "afr": null,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": null,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": null,
            "exp_life": 0.3,
            "id": 721092,
            "icon_id": 721092,
            "icon": "/static/icons/items/00721092.webp"
        },
        {
            "name": "Triple-Float Fishing Rod",
            "type": "rod",
            "afr": 0,
            "bonus_rare": 0,
            "bonus_big": 0,
            "durability": 30,
            "drr": null,
            "fish_multiplier": 1.6,
            "exp_fish": null,
            "exp_life": null,
            "id": 16153,
            "icon_id": 16152,
            "icon": "/static/icons/items/00016152.webp"
        },
        {
            "name": "Verdure Draught",
            "type": "buff",
            "afr": null,
            "bonus_rare": null,
            "bonus_big": null,
            "durability": null,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": null,
            "exp_life": 0.2,
            "id": 791,
            "icon_id": 791,
            "icon": "/static/icons/items/00000791.webp"
        },
        {
            "name": "Whaling",
            "type": "lightstone_set",
            "afr": null,
            "bonus_rare": null,
            "bonus_big": 0.06,
            "durability": null,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": 0.13,
            "exp_life": null,
            "id": null,
            "icon_id": null,
            "icon": null
        },
        {
            "name": "[Event] Crispy Goldfish Delight",
            "type": "buff",
            "afr": 0.1,
            "bonus_rare": 0.05,
            "bonus_big": null,
            "durability": null,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": null,
            "exp_life": 0.5,
            "id": 767163,
            "icon_id": 767163,
            "icon": "/static/icons/items/00767163.webp"
        },
        {
            "name": "[Event] Wise Housekeeper",
            "type": "buff",
            "afr": 0.1,
            "bonus_rare": 0.05,
            "bonus_big": null,
            "durability": null,
            "drr": null,
            "fish_multiplier": null,
            "exp_fish": null,
            "exp_life": null,
            "id": 768437,
            "icon_id": 768437,
            "icon": "/static/icons/items/00768437.webp"
        }
    ]

    const searchItem = (items, search, type) => items.filter(item =>
        item.name.toLowerCase().includes(search.toLowerCase()) && item.type.includes(type)
    );

    const rods = searchItem(items, '', 'rod')
    const floats = searchItem(items, '', 'float')
    const chairs = searchItem(items, '', 'chair')
    const backpacks = searchItem(items, '', 'backpack')
    const buffs = searchItem(items, '', 'buff')
    const foods = searchItem(items, '', 'food')
    const outfits = searchItem(items, '', 'outfit')
    const lightstone_sets = searchItem(items, '', 'lightstone_set')


    const selectedOption = `<button><div><selectedcontent></selectedcontent></div></button>`
    const noneOption = '<option value=""><span>None</span></option>\n'
    const mapOption = (list) => list.map(i => {
            let html = `<option value="${i.name}">`
            if (i.icon) {
                html += `
<img aria-hidden="true" src="${i.icon}" class="item-icon" alt="${i.name} icon"/>
`
            }
            html += `<span>${i.name}</span>
        </option>`
            return html
        }
    ).join('\n')
    const mapCheckbox = (list) => list.map(i => {
            let html = `<label>
<input data-bind-${i.type} type="checkbox" value="${i.name}">`
            if (i.icon) {
                html += `
<img aria-hidden="true" src="${i.icon}" class="item-icon" alt="${i.name} icon"/>
`
            }
            html += `<span>${i.name}</span>
        </label>`
            return html
        }
    ).join('\n')

    const rods_html = selectedOption + mapOption(rods)
    const chairs_html = selectedOption + noneOption + mapOption(chairs)
    const lightstone_sets_html = selectedOption + noneOption + mapOption(lightstone_sets)
    const floats_html = selectedOption + noneOption + mapOption(floats)
    const backpacks_html = selectedOption + noneOption + mapOption(backpacks)
    const buffs_html = mapCheckbox(buffs)
    const foods_html = mapCheckbox(foods)
    const outfits_html = mapCheckbox(outfits)

    const calcAFR = (gear) => {
        console.log(JSON.stringify(gear))
        return gear.reduce((acc, name) => {
            if (Array.isArray(name)) {
                acc += name.reduce((inner_acc, inner_name) => {
                    let obj = searchItem(items, inner_name, '')
                    console.log(obj)
                    if (obj.length === 1 && obj[0].afr) {
                        inner_acc += Number.parseFloat(obj[0].afr)
                    }
                    console.log(inner_acc)
                    return inner_acc
                }, 0.0)
            } else {
                let obj = searchItem(items, name, '')
                console.log(obj)
                if (obj.length === 1 && obj[0].afr) {
                    acc += Number.parseFloat(obj[0].afr)
                }
            }

            console.log(acc)
            return acc;
        }, 0.0).toFixed(2)
    }
    const calcDRR = (gear) => {
        console.log(JSON.stringify(gear))
        return gear.reduce((acc, name) => {
            if (Array.isArray(name)) {
                acc += name.reduce((inner_acc, inner_name) => {
                    let obj = searchItem(items, inner_name, '')
                    console.log(obj)
                    if (obj.length === 1 && obj[0].drr) {
                        inner_acc += Number.parseFloat(obj[0].drr)
                    }
                    return inner_acc
                }, 0.0)
            } else {
                let obj = searchItem(items, name, '')
                if (obj.length === 1 && obj[0].drr) {
                    acc += Number.parseFloat(obj[0].drr)
                }
            }
            return acc;
        }, 0.0)
    }
    const MAX_AUTOFISHING_TIME = 300
    const MIN_AUTOFISHING_TIME = 60


    const getBiteTime = (zone) => {
        return {bite_time_min: 40, bite_time_avg: 60, bite_time_max: 80}
    }
    const getAverageBiteTime = (zone) => getBiteTime(zone).bite_time_avg
    const calcAfTime = (afr) => Math.max(MIN_AUTOFISHING_TIME, MAX_AUTOFISHING_TIME * (1 - afr)).toFixed(2)
    const calcBiteTime = (zone, level, resources) => {
        const {bite_time_min, bite_time_avg, bite_time_max} = getBiteTime(zone)
        //if (zone.bite_time_min && zone.bite_time_max) {
        //    avgBitetime = (zone.bite_time_min + zone.bite_time_max)/2
        //}

        let factor_level = 1 - 0.15 // level 0 gives 15% reduction
        switch (level) {
            case 1: // level 1 gives 30% reduction
                factor_level = 1 - 0.3
                break
            default: // level 2-5 gives 30% + 5% reduction per level
                factor_level = 1 - (0.3 + 0.05 * (level - 1))
                break
        }
        let factor_resources = 2 - resources / 100
        console.log(`avgBiteTime: ${bite_time_avg}, factor_level: ${factor_level}, factor_resources = ${factor_resources}`)
        return (bite_time_avg * factor_level * factor_resources).toFixed(2)
    }

    const calcPercentageOfAverageTime = (time, zone) => (time / (getAverageBiteTime(zone) + MAX_AUTOFISHING_TIME) * 100).toFixed(2)

    const calcAbundancyLabel = (percentage) => {
        if (percentage <= 14) {
            return "Exhausted"
        } else if (percentage <= 45) {
            return "Low"
        } else if (percentage <= 70) {
            return "Average"
        } else if (percentage > 70) {
            return "Abundant"
        } else {
            return "invalid"
        }
    }
</script>

<div id="calculator"
     data-signals="{
       rod: 'Balenos Fishing Rod',
       float: '',
       chair: '',
       backpack: '',
       buff: [],
       food: [],
       outfit: [],
       lightstone_set: '',
       player_stats_fishing_level: 5,
       player_stats_fishing_lifeskill_level: 100,
       zone: '',
       resources: 0,
     }">

    <div data-computed-afr_uncapped="calcAFR([$rod, $chair, $buff, $food, $lightstone_set])"></div>
    <div data-computed-afr="Math.min(2/3, $afr_uncapped).toFixed(2)"></div>
    <div data-computed-drr="calcDRR([$rod, $chair, $buff, $outfit, $backpack, $lightstone_set])"></div>
    <div data-computed-aftime="calcAfTime($afr)"></div>
    <div data-computed-bitetime="calcBiteTime($zone, $player_stats_fishing_level, $resources)"></div>

    <div>
        <div id="fishing-timeline">
            <div data-attr="{style: 'flex-basis:' + calcPercentageOfAverageTime($bitetime, $zone) + '%;'}"
                 class="slider slider-bitetime"></div>
            <div data-attr="{style: 'flex-basis:' + calcPercentageOfAverageTime($aftime, $zone) + '%;'}"
                 class="slider slider-aftime"></div>
            <div class="slider slider-empty"></div>
        </div>
    </div>

    <p><label><input data-bind-debug type="checkbox">Debug</label></p>
    <code data-show=$debug>
        <pre data-text="ctx.signals.JSON()"></pre>
    </code>


    <label class="info-field flex w-full">
        <span class="flex">Fishing Resources:
            <input data-bind-resources type="range" min="0" max="100">
        </span>
        <span data-text="$resources + '% (' + calcAbundancyLabel($resources) + ')'"></span>
    </label>
    <div class="info-field flex w-full">Average Bite Time:
        <div data-text="$bitetime + ' seconds'"></div>
    </div>
    <div class="info-field flex w-full">Auto-Fishing Time (AFT):
        <div data-text="$aftime + ' seconds'"></div>
    </div>
    <div class="info-field flex w-full">Auto-Fishing Time Reduction (AFR):
        <div data-text="($afr_uncapped * 100).toFixed(2) + '%'"></div>
    </div>
    <div class="info-field flex w-full">Durability Reduction Resistance (DRR):
        <div data-text="($drr * 100).toFixed(2) + '%'"></div>
    </div>

    <div id="items" class="w-full flex flex-column">
        <label>Fishing Rod<select id="rods" data-bind-rod></select></label>
        <label>Float<select id="floats" data-bind-float></select></label>
        <label>Chair<select id="chairs" data-bind-chair></select></label>
        <label>Lightstone Set<select id="lightstone_sets" data-bind-lightstone_set></select></label>
        <label>Backpack<select id="backpacks" data-bind-backpack></select></label>
        <div>Outfit
            <div id="outfits" class="flex flex-column"></div>
        </div>
        <div>Food
            <div id="foods" class="flex flex-column"></div>
        </div>
        <div>Buffs
            <div id="buffs" class="flex flex-column"></div>
        </div>
    </div>
</div>

<script>
    document.getElementById('rods').innerHTML = rods_html
    document.getElementById('chairs').innerHTML = chairs_html
    document.getElementById('buffs').innerHTML = buffs_html
    document.getElementById('lightstone_sets').innerHTML = lightstone_sets_html
    document.getElementById('floats').innerHTML = floats_html
    document.getElementById('backpacks').innerHTML = backpacks_html
    document.getElementById('foods').innerHTML = foods_html
    document.getElementById('outfits').innerHTML = outfits_html
</script>
<style>
    label > select {
        min-width: 100%;
    }

    @supports (appearance: base-select) {
        select {
            /*
              new customizable appearance assignment.
              this changes what can go inside <select> and
              exposes parts you can target and style
            */

            &, &::picker(select) {
                appearance: base-select;
            }

            /* nice layout for the selected state */

            selectedcontent {
                display: flex;
                align-items: center;
                gap: .5ch;
            }

            /* icon at the end with grid */

            option {
                display: grid;
                grid-template-columns: [icon] auto [content] 1fr [mark] auto;

                &::checkmark {
                    display: none;
                }

                padding-block: 0.25rem;

                &:checked {
                    background: #61afef;
                }
            }
        }
    }

    @layer support {
        html {
            color-scheme: dark light;
        }
    }

    .item-icon {
        width: 30px;
        height: 30px;
    }


    .w-full {
        width: 100%;
    }

    .flex {
        display: flex;
    }

    .flex-column {
        flex-direction: column;
    }

    #fishing-timeline {
        width: 100%;
        display: inline-flex;
        position: relative;
        margin: 0 auto;
        height: 11px;
        overflow: hidden;
        background-color: #0e0e0e;
        outline: 2px solid #4e4e4e;
        border-radius: 8px;

        .slider {
            border-radius: 8px;
            height: 100%;
        }

        .slider-bitetime {
            background-color: #46d2a7;
        }

        .slider-aftime {
            background-color: #4e7296;
        }

        .slider-empty {
            flex-grow: 1;
        }
    }

    #items {
        label {
            margin: 0.35em 0;
        }

        & > div > div {
            margin: 1em 0;

            & > label {
                display: flex;
                align-items: center;
            }
        }
    }

    .info-field {
        justify-content: space-between;
        align-items: center;
        margin: 0.35em 0;
    }
</style>
```
...


